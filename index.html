<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>أداة المهندس محمود صحابي - مساحة شاملة</title>
    
    <style>
        body { background-color: #0a0a0a; color: #ffd700; text-align: center; font-family: 'Segoe UI', sans-serif; padding: 15px; margin: 0; }
        .main-card { background: #161616; padding: 20px; border-radius: 25px; border: 2px solid #ffd700; max-width: 550px; margin: auto; box-shadow: 0 15px 35px rgba(0,0,0,0.8); }
        h1 { font-size: 1.8rem; margin-bottom: 5px; color: #ffd700; }
        .tagline { color: #888; font-size: 0.9rem; margin-bottom: 20px; }
        
        .display-section { background: #222; padding: 15px; border-radius: 15px; margin-bottom: 15px; border-right: 5px solid #ffd700; }
        .coord-label { color: #ffd700; font-size: 0.8rem; text-align: right; display: block; margin-bottom: 5px; }
        .coord-value { color: #fff; font-family: 'Courier New', monospace; font-size: 1.2rem; font-weight: bold; word-break: break-all; }

        button { width: 100%; padding: 16px; margin: 8px 0; border-radius: 15px; border: none; font-weight: bold; font-size: 16px; cursor: pointer; transition: 0.3s; }
        .btn-update { background-color: #ffd700; color: #000; }
        .btn-civil { background-color: #1e88e5; color: #fff; } /* أزرق للسيفيل */
        .btn-earth { background-color: #2e7d32; color: #fff; }  /* أخضر لجوجل إيرث */

        .map-box { margin-top: 15px; height: 250px; border-radius: 15px; overflow: hidden; border: 1px solid #333; }
        iframe { width: 100%; height: 100%; border: none; }
    </style>
</head>
<body>

    <div class="main-card">
        <h1>المهندس محمود صحابي</h1>
        <div class="tagline">نظام الرصد المتكامل (Civil 3D & Google Earth)</div>

        <div class="display-section">
            <span class="coord-label">إحداثيات Civil 3D (E, N) - أمتار</span>
            <div class="coord-value" id="civil-display">E: 0.000 | N: 0.000</div>
        </div>

        <div class="display-section">
            <span class="coord-label">إحداثيات Google Earth (Lat, Lon) - درجات</span>
            <div class="coord-value" id="gps-display">Lat: 0.00000000 | Lon: 0.00000000</div>
        </div>

        <button class="btn-update" onclick="fetchLocation()">تحديث رصد النقطة الحالية</button>
        <button class="btn-civil" onclick="downloadForCivil()">تحميل ملف Civil 3D (CSV)</button>
        <button class="btn-earth" onclick="downloadForEarth()">تحميل ملف Google Earth (CSV)</button>

        <div class="map-box" id="mapView">
            <p style="padding-top: 100px; color: #444;">في انتظار تحديد الموقع...</p>
        </div>
    </div>

    <script>
        let rawLat = 0, rawLon = 0;

        function fetchLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(p => {
                    rawLat = p.coords.latitude;
                    rawLon = p.coords.longitude;
                    
                    // تحويل تقريبي للأمتار (UTM Zone 38/39) لخدمة السيفيل
                    let easting = (rawLon * 100000).toFixed(3);
                    let northing = (rawLat * 111000).toFixed(3);

                    // تحديث الشاشة
                    document.getElementById('civil-display').innerText = `E: ${easting} | N: ${northing}`;
                    document.getElementById('gps-display').innerText = `Lat: ${rawLat.toFixed(8)} | Lon: ${rawLon.toFixed(8)}`;

                    // تحديث الخريطة
                    const mapUrl = `https://www.google.com/maps?q=$${rawLat},${rawLon}&z=18&output=embed`;
                    document.getElementById('mapView').innerHTML = `<iframe src="${mapUrl}"></iframe>`;
                }, null, {enableHighAccuracy: true});
            }
        }

        // تصدير للسيفيل (P,N,E,Z,D)
        function downloadForCivil() {
            if (rawLat === 0) return alert("ارصد النقطة أولاً!");
            let n = (rawLat * 111000).toFixed(3);
            let e = (rawLon * 100000).toFixed(3);
            saveFile(`1,${n},${e},0,SAHABY_CIVIL`, "Sahaby_Civil3D.csv");
        }

        // تصدير لجوجل إيرث (Name, Latitude, Longitude)
        function downloadForEarth() {
            if (rawLat === 0) return alert("ارصد النقطة أولاً!");
            // جوجل إيرث يفهم ملفات CSV إذا كانت الأعمدة واضحة
            let content = "Name,Latitude,Longitude,Description\n";
            content += `Sahaby_Point,${rawLat.toFixed(10)},${rawLon.toFixed(10)},Survey_By_Mahmoud_Sahaby`;
            saveFile(content, "Sahaby_GoogleEarth.csv");
        }

        function saveFile(data, filename) {
            let blob = new Blob([data], { type: 'text/csv' });
            let link = document.createElement("a");
            link.href = URL.createObjectURL(blob);
            link.download = filename;
            link.click();
        }
    </script>
</body>
</html>
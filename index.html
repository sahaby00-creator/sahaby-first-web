<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>أداة المهندس محمود صحابي للمساحة والـ Civil 3D</title>
    
    <meta name="description" content="أداة مساحية متطورة للمهندس محمود صحابي لتحويل الإحداثيات وتصدير ملفات النقاط لبرنامج Civil 3D في الرياض.">
    <meta name="keywords" content="محمود صحابي, مهندس مساحة, Civil 3D, تصدير نقاط, الرياض, GPS Survey">

    <style>
        body { background-color: #121212; color: #ffd700; text-align: center; font-family: 'Segoe UI', sans-serif; padding: 20px; margin: 0; }
        h1 { font-size: 2rem; color: #ffd700; margin-bottom: 5px; }
        .sub-header { color: #fff; font-size: 1rem; margin-bottom: 20px; }
        
        /* حاوية البيانات */
        .survey-box {
            background: #1e1e1e;
            padding: 20px;
            border-radius: 15px;
            border: 1px solid #ffd700;
            max-width: 500px;
            margin: 0 auto 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.5);
        }

        .coord-display { font-family: monospace; font-size: 1.2rem; margin: 10px 0; color: #fff; }
        
        /* الأزرار بنظام iPhone 11 */
        button {
            background-color: #ffd700;
            color: #000;
            padding: 15px 25px;
            border-radius: 12px;
            border: none;
            font-weight: bold;
            font-size: 16px;
            cursor: pointer;
            margin: 10px 5px;
            width: 80%;
            max-width: 300px;
            transition: 0.3s;
        }

        button:active { transform: scale(0.95); }
        .btn-download { background-color: #28a745; color: white; } /* أخضر لملفات الإكسيل */

        .map-frame {
            margin: 20px auto;
            max-width: 95%;
            height: 300px;
            border-radius: 15px;
            overflow: hidden;
            border: 1px solid #ffd700;
        }
        iframe { width: 100%; height: 100%; border: none; }
    </style>
</head>
<body>

    <h1>المهندس محمود صحابي</h1>
    <div class="sub-header">مساعد المساحة الرقمي و Civil 3D - الرياض</div>

    <div class="survey-box">
        <div id="status">انتظار جلب الإحداثيات...</div>
        <div class="coord-display" id="lat-val">Lat: --.------</div>
        <div class="coord-display" id="lon-val">Lon: --.------</div>
    </div>

    <button onclick="getLocation()">تحديث الموقع اللحظي</button>
    <button class="btn-download" onclick="downloadCSV()">تصدير لنقاط Civil 3D (CSV)</button>
    
    <div class="map-frame" id="mapDisplay">
        <p style="padding-top: 130px; color: #444;">الخريطة ستظهر هنا</p>
    </div>

    <script>
        let currentLat = 0;
        let currentLon = 0;

        function getLocation() {
            if (navigator.geolocation) {
                document.getElementById('status').innerText = "جاري الاتصال بالأقمار الصناعية...";
                navigator.geolocation.getCurrentPosition(showPosition, showError, {
                    enableHighAccuracy: true
                });
            }
        }

        function showPosition(position) {
            currentLat = position.coords.latitude;
            currentLon = position.coords.longitude;
            
            document.getElementById('status').innerText = "تم جلب الموقع بنجاح ✅";
            document.getElementById('lat-val').innerText = "Latitude: " + currentLat.toFixed(8);
            document.getElementById('lon-val').innerText = "Longitude: " + currentLon.toFixed(8);

            const mapUrl = `https://maps.google.com/maps?q=${currentLat},${currentLon}&z=17&output=embed`;
            document.getElementById('mapDisplay').innerHTML = `<iframe src="${mapUrl}"></iframe>`;
        }

        // وظيفة تصدير الملف لبرنامج Civil 3D بصيغة (Point Number, Easting, Northing, Elevation, Description)
        function downloadCSV() {
            if (currentLat === 0) {
                alert("يرجى جلب الموقع أولاً!");
                return;
            }

            // ملاحظة للمهندس محمود: Civil 3D يحب صيغة P,N,E,Z,D
            // هنا نضع الإحداثيات الجغرافية كبداية
            let csvContent = "data:text/csv;charset=utf-8,";
            csvContent += "Point_Number,Northing,Easting,Elevation,Description\r\n";
            csvContent += `1,${currentLat.toFixed(8)},${currentLon.toFixed(8)},0,Survey_Point_Sahaby`;

            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", "sahaby_points_for_civil3d.csv");
            document.body.appendChild(link);
            link.click();
        }

        function showError(error) {
            document.getElementById('status').innerText = "خطأ: يرجى تفعيل الـ GPS";
        }

        window.onload = getLocation;
    </script>
</body>
</html>